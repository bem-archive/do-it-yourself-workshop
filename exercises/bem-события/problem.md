## БЭМ-события

BEM-событие — собственное событие, генерируемое блоком. Позволяет организовать API для взаимодействия с блоком. BEM-события обычно обрабатывает экземпляр блока, отслеживающий состояние других блоков, на которых генерируются события.

Планируя архитектуру интерфейса, нужно учитывать, что DOM-события следует использовать только во внутренних процедурах блока. Для взаимодействия блока с внешней средой (другими блоками) предназначены BEM-события.

-------------------------------------------------------------------------------

**NB**: Работа с DOM-событиями полностью реализована средствами фреймворка jQuery.

-------------------------------------------------------------------------------

В отличие от DOM-событий, BEM-события генерируются не на DOM-элементах, а на **экземплярах блоков**. Элементы блоков не могут генерировать BEM-события.

Чтобы сгенерировать BEM-событие, используется метод экземпляра блока `emit(event)`.

**Пример**: Взаимодействие пользователя с элементом управления блока
  (DOM-событие) можно преобразовать в BEM-событие на блоке. В
  приведенном ниже примере при клике пользователя по кнопке `submit`
  (DOM-событие `click`) **BEM-событие** `click` генерируется только в
  том случае, если у блока в этот момент не выставлен модификатор
  `disabled`:

```js
DOM.decl('submit', {
    onSetMod: {
        'js': {
            'inited': function() {
                this.bindTo('click', this._onClick); // подписка на DOM-событие "click"
            }
        }
    },

    _onClick: function() {
        if(!this.hasMod('disabled')) {
            this.emit('click'); // создание BEM-события "click"
        }
    }
});
```

Для подписки на BEM-события экземпляров блоков используются методы
экземпляра блока `on(event, [data], handler, [handlerCtx])`.

**Пример**: В момент инициализации HTML-формы (экземпляра блока `my-form`)
выполняется поиск вложенной в форму кнопки `submit` и подписка на
BEM-событие `click` этой кнопки. В результате при нажатии на кнопку
(экземпляр блока `submit`) будет выполнен метод `_onSubmit` формы
(экземпляр блока `my-form`).

```js
DOM.decl('my-form', {
    onSetMod: {
        'js': {
            'inited': function() {
                this.findBlockInside('submit').on(
                    'click', // имя BEM-события
                    this._onSubmit, // метод экземпляра блока my-form
                    this); // контекст для выполнения _onSubmit — блок my-form
            }
        }
    },

    _onSubmit: function() { /* ... */ }
});
```

-------------------------------------------------------------------------------

**NB:** Если не указывать последний параметр метода `on` —
  `[handlerCtx]`, контекстом для выполнения функции-обработчика будет
  тот блок, в котором возникло BEM-событие. (В примере выше — это блок
  `submit`.)

-------------------------------------------------------------------------------


**Удаление подписки** на BEM-события выполняется автоматически при
уничтожении экземпляра блока. Если требуется удалить подписку вручную
в процессе работы блока, следует использовать метод экземпляра блока
`un(event, [handler], [handlerCtx])`.

-------------------------------------------------------------------------------

Возвращаемся к заданию

-------------------------------------------------------------------------------

```js
modules.define('form', ['i-bem__dom'], function(provide, BEMDOM) {
    provide(BEMDOM.decl(this.name, {
        onSetMod: {
            js: {
                inited: function() {
                    this.bindTo('submit', this._onSubmit);
                    // подписаться на БЭМ-событие `submit`
                    // и вывести в консоль сообщение 'BEM-event'
                }
            }
        },
        _onSubmit: function(e) {
            // отменить дефолтное поведение формы
            // сгенерировать БЭМ-событие `submit`
        },
        getVal: function() {
            return this.domElem.serialize();
        }
    }))
})
```

Мы объявили модуль `form`, в зависимости которого добавили модуль `i-bem__dom`, поскольку блок будет иметь DOM-представление. Этот модуль предоставляет объект `BEMDOM`. С помощью этого объекта мы декларируем блок `form`. Конструктором нашего блока является функция, объявляемая в верхней части кода. Кроме того, у нашего блока есть приватный обработчик `_onSubmit`, отвечающий за реакцию на отправку формы, и публичный метод `getVal`, который возвращает результат сериализации формы.

В методе `_onSubmit()` мы указываем `e.preventDefault()`, чтобы избежать перезагрузки страницы, и после этого генерируем БЭМ-событие `submit`, которое в дальнейшем будет использоваться в коде других блоков. Получается, что мы только что создали публичное АПИ блока `form`. Оно состоит из публичного метода и БЭМ-события.

Давайте вместо дефолтного DOM-события `submit` вызывать BEM-событие `submit` и обрабатывать его. Выведем `BEM-event` в консоли.

Допишите блок `form` и запустите тест `node bfs-workshop verify`.
